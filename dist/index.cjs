"use strict";var o=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var u=Object.prototype.hasOwnProperty;var h=(s,e)=>{for(var t in e)o(s,t,{get:e[t],enumerable:!0})},f=(s,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of v(e))!u.call(s,i)&&i!==t&&o(s,i,{get:()=>e[i],enumerable:!(n=E(e,i))||n.enumerable});return s};var L=s=>f(o({},"__esModule",{value:!0}),s);var M={};h(M,{Emitter:()=>p,EmitterIdDedupeMode:()=>r});module.exports=L(M);var r={ADD:"add",UPDATE:"update",IGNORE:"ignore",THROW:"throw"};function c(s,e){let t=s.get(e);return t||(t=new l,s.set(e,t)),t}var l=class{constructor(){this.idMap=new Map,this.cbMap=new Map,this.onceList=new Set,this.emitList=null}add(e,t,n,i,d){if(!d&&this.cbMap.has(e))throw new Error("Emitter: tried to add an existing event listener to an event!");if(this.idMap.has(n))switch(i){case r.THROW:throw new Error("Emitter: tried to add an existing event listener id to an event!");case r.IGNORE:return n;default:this.delId(n,i===r.UPDATE)}let a=this.cbMap.get(e);return a===void 0?this.cbMap.set(e,n):a instanceof Set?a.add(n):this.cbMap.set(e,new Set([a,n])),this.idMap.set(n,e),t&&this.onceList.add(n),this.emitList&&this.emitList.push(e),n}delId(e,t=!1){let n=this.idMap.get(e);if(!n)return;t||this.idMap.delete(e),this.onceList.delete(e);let i=this.cbMap.get(n);i instanceof Set?(i.delete(e),i.size||this.cbMap.delete(n)):this.cbMap.delete(n),this.emitList=null}delFn(e){let t=this.cbMap.get(e);if(t!==void 0){if(t instanceof Set)for(let n of t)this.onceList.delete(n),this.idMap.delete(n);else this.onceList.delete(t),this.idMap.delete(t);this.cbMap.delete(e),this.emitList=null}}},p=class{constructor(e={}){let{idDedupeMode:t=r.ADD,allowDuplicateListeners:n=!0}=e;this.idDedupeMode=t,this.createId=e.createId||Symbol,this.allowDuplicateListeners=n,this._events=new Map}_getListeners(e){let t=this._events.get(e);if(!t)return null;let{idMap:n,onceList:i}=t;if(!n.size)return null;let d=t.emitList||[...n.values()];if(i.size)if(i.size===n.size)this._events.delete(e);else for(let a of i)t.delId(a);else t.emitList=d;return d}on(e,t,n=this.createId()){return c(this._events,e).add(t,!1,n,this.idDedupeMode,this.allowDuplicateListeners)}once(e,t,n=this.createId()){return c(this._events,e).add(t,!0,n,this.idDedupeMode,this.allowDuplicateListeners)}off(e,t){if(e===void 0){this._events.clear();return}if(t===void 0){this._events.delete(e);return}let n=this._events.get(e);n&&(typeof t=="function"?n.delFn(t):n.delId(t),n.idMap.size||this._events.delete(e))}emit(e,...t){let n=this._getListeners(e);if(!n)return;let i=0,d=n.length;for(;i<d;i++)n[i](...t)}listenerCount(e){if(e===void 0){let t=0;return this._events.forEach((n,i)=>{t+=this.listenerCount(i)}),t}return this._events.get(e)?.idMap.size||0}};0&&(module.exports={Emitter,EmitterIdDedupeMode});
