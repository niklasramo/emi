!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Emitter={})}(this,(function(e){"use strict";function t(e,t){let s=e.get(t);return s||(s=new i,e.set(t,s)),s}class i{idMap;fnMap;onceList;emitList;constructor(){this.idMap=new Map,this.fnMap=new Map,this.onceList=new Set,this.emitList=null}add(e,t){let i=this.fnMap.get(e);i||(i=new Set,this.fnMap.set(e,i));const s=Symbol();return i.add(s),this.idMap.set(s,e),t&&this.onceList.add(s),this.emitList&&this.emitList.push(e),s}delId(e){if(!this.idMap.has(e))return;const t=this.idMap.get(e),i=this.fnMap.get(t);this.onceList.delete(e),this.idMap.delete(e),i.delete(e),i.size||this.fnMap.delete(t),this.emitList=null}delFn(e){const t=this.fnMap.get(e);if(t){for(const e of t)this.onceList.delete(e),this.idMap.delete(e);this.fnMap.delete(e),this.emitList=null}}}e.Emitter=class{_events;constructor(){this._events=new Map}on(e,i){return t(this._events,e).add(i)}once(e,i){return t(this._events,e).add(i,!0)}off(e,t){if(void 0===e)return void this._events.clear();if(void 0===t)return void this._events.delete(e);const i=this._events.get(e);i&&("function"==typeof t?i.delFn(t):i.delId(t),i.idMap.size||this._events.delete(e))}emit(e,...t){const i=this._events.get(e);if(!i)return;const{idMap:s,onceList:n}=i;if(!s.size)return;const d=i.emitList||[...s.values()];if(n.size)if(n.size===s.size)this._events.delete(e);else for(const e of n)i.delId(e);else i.emitList=d;let o=0,f=d.length;for(;o<f;o++)d[o](...t)}},Object.defineProperty(e,"__esModule",{value:!0})}));